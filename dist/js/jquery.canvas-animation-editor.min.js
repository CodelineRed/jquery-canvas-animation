!function(_){_.fn.canvasAnimationEditor=function(m){var r=this,a=[],s="",d="",o="",p="",h=0,v=0;m=_.extend({enable:!1,decimal:2,draggableItems:!0,labels:{top:"top",left:"left",width:"width",height:"height",newItem:"New: ",newItemBlank:"Blank",newItemExt:"Extended",select:"Select: ",selectCss:"CSS",selectHtml:"HTML",remove:"Remove: ",removeItem:"Item",removeStyle:"Style",className:"CSS class name",parentWidth:"Parent width in px",parentHeight:"Parent height in px",itemWidth:"Item width in px",itemHeight:"Item height in px",itemTop:"Item offset top in px",itemLeft:"Item offset left in px",confirmAppendPrepend:"OK = append item / Cancel = prepend item",confirmRemoveItem:"Are you sure to remove item?",confirmRemoveStyle:"Are you sure to remove style?",alertCanvasId:'Canvas needs attribute "id".'},template:'<div class="jca-editor"><div class="jca-container"><div class="jca-col jca-cord-dimension"><div class="jca-box"><div class="jca-label jca-top"></div><div class="jca-label jca-left"></div><div class="jca-label jca-width"></div><div class="jca-label jca-height"></div><input type="number" step="0.01" name="jca_top" /><input type="number" step="0.01" name="jca_left" /><input type="number" step="0.01" name="jca_width" /><input type="number" step="0.01" name="jca_height" /></div></div><div class="jca-col jca-selector-breadcrumb"></div><div class="jca-col"><div id="jca-html"></div><div id="jca-css"></div></div><div class="jca-col"><span class="jca-new"></span><input type="button" name="jca_new_item" value=""/> <input type="button" name="jca_new_item_ext" value=""/><br/><span class="jca-select"></span><input type="button" name="jca_html" value=""/> <input type="button" name="jca_css" value=""/><br/><span class="jca-remove"></span><input type="button" name="jca_remove_item" value=""/> <input type="button" name="jca_remove_style" value=""/><br/></div></div></div>'},m);if("undefined"!==r.attr("id")){var e=_(m.template);e.find(".jca-label.jca-top").attr("data-label",m.labels.top),e.find(".jca-label.jca-left").attr("data-label",m.labels.left),e.find(".jca-label.jca-width").attr("data-label",m.labels.width),e.find(".jca-label.jca-height").attr("data-label",m.labels.height),e.find('[name="jca_new_item"]').val(m.labels.newItemBlank),e.find('[name="jca_new_item_ext"]').val(m.labels.newItemExt),e.find('[name="jca_css"]').val(m.labels.selectCss),e.find('[name="jca_html"]').val(m.labels.selectHtml),e.find('[name="jca_remove_item"]').val(m.labels.removeItem),e.find('[name="jca_remove_style"]').val(m.labels.removeStyle),e.find(".jca-new").text(m.labels.newItem),e.find(".jca-select").text(m.labels.select),e.find(".jca-remove").text(m.labels.remove),_("body").prepend(e),m.decimal<1&&(m.decimal=2),e.find('[name="jca_top"]').attr("step",1/Math.pow(10,m.decimal)),e.find('[name="jca_left"]').attr("step",1/Math.pow(10,m.decimal)),e.find('[name="jca_width"]').attr("step",1/Math.pow(10,m.decimal)),e.find('[name="jca_height"]').attr("step",1/Math.pow(10,m.decimal)),r.attr("data-hash",f()),_(".jca-selector-breadcrumb").html(i(r)),_("*",r).each(function(){_(this).attr("data-hash",f()),_(this).attr("data-class",_(this).attr("class")),u(_(this))}),_(r).click(function(e){var a=_(e.target);r.hide(),_("*",r).removeClass("jca-active-element"),_("*",r).css("background-color",""),void 0===a.attr("id")||void 0!==a.attr("id")&&a.attr("id")!==r.attr("id")?(_('[name="jca_top"]').val(parseFloat(a.css("top"))),_('[name="jca_left"]').val(parseFloat(a.css("left"))),_('[name="jca_width"]').val(parseFloat(a.css("width"))),_('[name="jca_height"]').val(parseFloat(a.css("height"))),a.addClass("jca-active-element"),a.css("background-color",b()),_("#jca-css").html(c(a)),_("#jca-html").html(l(a))):(_('[name="jca_top"]').val(""),_('[name="jca_left"]').val(""),_('[name="jca_width"]').val(""),_('[name="jca_height"]').val(""),_("#jca-css").html(""),_("#jca-html").html("")),r.show(),_(".jca-selector-breadcrumb").html(i(a)),(void 0===a.attr("id")||void 0!==a.attr("id")&&a.attr("id")!==r.attr("id"))&&u(a)}),_(".jca-cord-dimension input").change(function(){t()}),_(".jca-cord-dimension input").keyup(function(){t()}),_('[name="jca_new_item"]').click(function(){j(prompt(m.labels.className),"0","0","25%","25%")}),_('[name="jca_new_item_ext"]').click(function(){var e=prompt(m.labels.className),a=s=parseInt(prompt(m.labels.parentWidth,s)),t=d=parseInt(prompt(m.labels.parentHeight,d)),c=p=parseInt(prompt(m.labels.itemWidth,p)),l=o=parseInt(prompt(m.labels.itemHeight,o)),n=h=parseInt(prompt(m.labels.itemTop,h)),i=v=parseInt(prompt(m.labels.itemLeft,v));j(e,(100*n/t).toFixed(m.decimal)+"%",(100*i/a).toFixed(m.decimal)+"%",(100*c/a).toFixed(m.decimal)+"%",(100*l/t).toFixed(m.decimal)+"%")}),_('[name="jca_remove_item"]').click(function(){if(_(".jca-active-element").length&&confirm(m.labels.confirmRemoveItem+" "+n(_(".jca-active-element")))){var e=_(".jca-active-element").parent();_(".jca-active-element").remove(),e.click()}}),_('[name="jca_remove_style"]').click(function(){_(".jca-active-element").length&&confirm(m.labels.confirmRemoveStyle+" "+n(_(".jca-active-element")))&&_(".jca-active-element").attr("style","")}),_('[name="jca_css"]').click(function(){g("jca-css")}),_('[name="jca_html"]').click(function(){g("jca-html")}),_(".jca-selector-breadcrumb").on("click","a",function(e){e.preventDefault(),_('[data-hash="'+_(this).attr("href")+'"]').click()})}else alert(m.labels.alertCanvasId);function j(e,a,t,c,l){var n=_('<div class="'+e+'" data-class="'+e+'"></div>');n.css("position","absolute"),n.css("top",a),n.css("left",t),n.css("width",c),n.css("height",l),n.attr("data-hash",f()),n.css("background-color",b());var i='[data-hash="'+n.attr("data-hash")+'"]';if(_("head").append("<style>"+i+"{background-color:"+b()+"}</style>"),e.length){if(_(".jca-active-element").length)var s=_(".jca-active-element");else s=r;confirm(m.labels.confirmAppendPrepend)?s.append(n):s.prepend(n),_(i).click()}u(_(i))}function c(e){var a=n(e)+" {<br/>";return a+="&nbsp;&nbsp;&nbsp;&nbsp;top: "+e.css("top")+";<br>",a+="&nbsp;&nbsp;&nbsp;&nbsp;left: "+e.css("left")+";<br>",a+="&nbsp;&nbsp;&nbsp;&nbsp;width: "+e.css("width")+";<br>",a+="&nbsp;&nbsp;&nbsp;&nbsp;height: "+e.css("height")+";<br>",a+="}"}function l(e){return('<div class="'+e.data("class")+'"></div>').replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function n(e){var a=(e=e.clone()).attr("id"),t=e.data("class"),c="";return void 0!==a&&a.length&&(c+="#"+a),void 0!==t&&t.length&&(c+="."+t.replace(/ /gi,".")),c}function b(){for(var e="#",a=0;a<6;a++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e}function i(e){var a=e.attr("id"),t="";return(void 0===a||void 0!==a&&a!==r.attr("id"))&&(t=i(e.parent())),t+'<a href="'+e.data("hash")+'">'+n(e)+'</a> <span class="jca-pointer">></span> '}function f(){for(var e="";e=b(),-1<a.indexOf(e););return a.push(e),e}function u(t){m.draggableItems&&"function"==typeof _.fn.draggable&&!t.hasClass("ui-draggable")&&t.draggable({stop:function(e,a){_("*",r).removeClass("jca-active-element"),t.css("top",(100*parseFloat(t.css("top"))/t.parent().height()).toFixed(m.decimal)+"%"),t.css("left",(100*parseFloat(t.css("left"))/t.parent().width()).toFixed(m.decimal)+"%"),_('[name="jca_top"]').val((100*parseFloat(t.css("top"))/t.parent().height()).toFixed(m.decimal)),_('[name="jca_left"]').val((100*parseFloat(t.css("left"))/t.parent().width()).toFixed(m.decimal)),r.hide(),_('[name="jca_width"]').val(parseFloat(t.css("width"))),_('[name="jca_height"]').val(parseFloat(t.css("height"))),_("#jca-css").html(c(t)),_("#jca-html").html(l(t)),r.show(),_(".jca-selector-breadcrumb").html(i(t)),_(a.helper).hasClass("jca-active-element")||_(a.helper).addClass("jca-active-element")}})}function t(){if(_(".jca-active-element").length){var e=_(".jca-active-element");e.css("top",_('[name="jca_top"]').val()+"%"),e.css("left",_('[name="jca_left"]').val()+"%"),e.css("width",_('[name="jca_width"]').val()+"%"),e.css("height",_('[name="jca_height"]').val()+"%"),r.hide(),_("#jca-css").html(c(e)),r.show()}else _('[name="jca_top"]').val(""),_('[name="jca_left"]').val(""),_('[name="jca_width"]').val(""),_('[name="jca_height"]').val("")}function g(e){var a,t,c=document,l=c.getElementById(e);c.body.createTextRange?((a=document.body.createTextRange()).moveToElementText(l),a.select()):window.getSelection&&(t=window.getSelection(),(a=document.createRange()).selectNodeContents(l),t.removeAllRanges(),t.addRange(a))}}}(jQuery);