!function(f){f.fn.canvasAnimation=function(t){var a,o=this,s=(t=f.extend({steps:[],timeout:0,resetDuration:500,infinite:!0,autoplay:!0,controls:!0,editor:{enable:!1},fontawesomeVersion:null,controlsWrapper:".jca-controls",backwardButton:".jca-backward",playButton:".jca-play",pauseButton:".jca-pause",resetButton:".jca-reset",forwardButton:".jca-forward",expandButton:".jca-expand",editButton:".jca-edit",classDone:"jca-done",classWait:"jca-wait",classForward:"jca-forward",classBackward:"jca-backward",classWrap:"jca-wrap",controlsTemplate:'<div class="jca-controls"><div class="jca-backward"></div><div class="jca-play"></div><div class="jca-pause"></div><div class="jca-reset"></div><div class="jca-forward"></div><div class="jca-expand"></div><div class="jca-edit"></div></div>',onPlay:null,onDone:null,onWait:null},t)).infinite,l=[],i=-1,e=f(t.controlsTemplate);switch(t.editor.enable=t.editor.enable&&"function"==typeof f.fn.canvasAnimationEditor,o.wrap('<div class="'+t.classWrap+'"></div>'),parseInt(t.fontawesomeVersion)){case 4:case 5:var n="fa";5===parseInt(t.fontawesomeVersion)&&(n="fas"),f("html").addClass("jca-fontawesome"),e.find(t.backwardButton).append('<i class="'+n+' fa-step-backward"></i>'),e.find(t.playButton).append('<i class="'+n+' fa-play"></i>'),e.find(t.pauseButton).append('<i class="'+n+' fa-pause"></i>'),e.find(t.resetButton).append('<i class="'+n+' fa-stop"></i>'),e.find(t.forwardButton).append('<i class="'+n+' fa-step-forward"></i>'),e.find(t.expandButton).append('<i class="'+n+' fa-expand"></i>'),e.find(t.editButton).append('<i class="'+n+' fa-edit"></i>')}t.controls&&(t.editor.enable||e.find(t.editButton).remove(),o.closest("."+t.classWrap).append(e.clone()));var c=function(s){s&&s()},r=function(){var n=t.timeout;l=[],o.hasClass(t.classDone)&&u(),o.hasClass(t.forwardButton.substring(1))&&i--,o.hasClass(t.classDone)&&(o.removeClass(t.classDone),n+=t.resetDuration),o.removeClass(t.classWait),c(t.onPlay),f.each(t.steps,function(s,a){if(i<s){var e=setTimeout(function(){i=s,o.addClass(a.addClass),o.removeClass(a.removeClass),"boolean"==typeof a.pause&&!0===a.pause&&(t.infinite=!1,p(!1)),t.steps.length-1===s&&d(a.duration)},n);"number"!=typeof a.duration&&(a.duration=500),n+=a.duration,l.push(e)}})},d=function(s){a=setTimeout(function(){o.addClass(t.classDone),o.hasClass(t.classWait)||(t.infinite?r():c(t.onDone))},s)},u=function(){f.each(t.steps,function(s,a){o.removeClass(a.addClass)}),i=-1},p=function(s){0<l.length&&(f.each(l,function(s,a){clearTimeout(l[s])}),s&&u(),o.addClass(t.classWait),c(t.onWait),void 0!==a&&clearTimeout(a))};t.autoplay?r():(o.addClass(t.classWait),c(t.onWait)),t.editor.enable||o.click(function(){t.infinite=s,(o.hasClass(t.classDone)||o.hasClass(t.classWait))&&r()}),o.next(t.controlsWrapper).find(t.backwardButton).click(function(){(o.hasClass(t.classDone)||o.hasClass(t.classWait))&&(o.hasClass(t.classForward)&&i--,o.removeClass(t.classForward),o.addClass(t.classBackward),i<0&&(i=t.steps.length),i===t.steps.length?f.each(t.steps,function(s,a){o.addClass(a.addClass),o.removeClass(a.removeClass)}):(o.removeClass(t.steps[i].addClass),o.addClass(t.steps[i].removeClass)),i--)}),o.next(t.controlsWrapper).find(t.playButton).click(function(){t.infinite=s,(o.hasClass(t.classDone)||o.hasClass(t.classWait))&&r()}),o.next(t.controlsWrapper).find(t.pauseButton).click(function(){t.infinite=!1,p(!1)}),o.next(t.controlsWrapper).find(t.resetButton).click(function(){t.infinite=!1,p(!0),u(),o.removeClass(t.classDone),o.addClass(t.classWait),c(t.onWait)}),o.next(t.controlsWrapper).find(t.forwardButton).click(function(){(o.hasClass(t.classDone)||o.hasClass(t.classWait))&&(o.hasClass(t.classBackward)&&i++,o.addClass(t.classForward),o.removeClass(t.classBackward),(i>t.steps.length||-1===i)&&(i=0),i===t.steps.length?u():(o.addClass(t.steps[i].addClass),o.removeClass(t.steps[i].removeClass)),i++)}),o.next(t.controlsWrapper).find(t.expandButton).click(function(){var s;(s=o[0]).requestFullscreen?s.requestFullscreen():s.mozRequestFullScreen?s.mozRequestFullScreen():s.msRequestFullscreen?s.msRequestFullscreen():s.webkitRequestFullscreen&&s.webkitRequestFullscreen()}),t.editor.enable&&(o.canvasAnimationEditor(t.editor),o.next(t.controlsWrapper).find(t.editButton).click(function(){f(".jca-editor").is(":visible")?f(".jca-editor").hide():f(".jca-editor").show()}))}}(jQuery);