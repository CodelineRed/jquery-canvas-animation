!function(s){s.fn.canvasAnimation=function(a){var e,t=this,a=s.extend({steps:[],timeout:0,reset_duration:500,infinity:!0,autoplay:!0,controls:!0,controls_fa:null,controls_wrapper:".controls",step_backward_button:".step-backward",play_button:".play",pause_button:".pause",reset_button:".reset",step_forward_button:".step-forward",fullscreen_button:".fullscreen",class_done:"done",class_wait:"wait",class_forward:"forward",class_backward:"backward",class_wrap:"canvas-animation",controls_template:'<div class="controls"><div class="step-backward #STEPBACKWARD#"></div><div class="play #PLAY#"></div><div class="pause #PAUSE#"></div><div class="reset #RESET#"></div><div class="step-forward #STEPFORWARD#"></div><div class="fullscreen #FULLSCREEN#"></div></div>',callback_play:null,callback_done:null,callback_wait:null},a),l=a.infinity,n=[],c=-1;switch(t.wrap('<div class="'+a.class_wrap+'"></div>'),parseInt(a.controls_fa)){case 4:case 5:var o="fa";5===parseInt(a.controls_fa)&&(o="fas"),a.controls_template=a.controls_template.replace("#STEPBACKWARD#",o+" fa-step-backward"),a.controls_template=a.controls_template.replace("#PLAY#",o+" fa-play"),a.controls_template=a.controls_template.replace("#PAUSE#",o+" fa-pause"),a.controls_template=a.controls_template.replace("#RESET#",o+" fa-stop"),a.controls_template=a.controls_template.replace("#STEPFORWARD#",o+" fa-step-forward"),a.controls_template=a.controls_template.replace("#FULLSCREEN#",o+" fa-expand");break;default:a.controls_template=a.controls_template.replace("#STEPBACKWARD#",""),a.controls_template=a.controls_template.replace("#PLAY#",""),a.controls_template=a.controls_template.replace("#PAUSE#",""),a.controls_template=a.controls_template.replace("#RESET#",""),a.controls_template=a.controls_template.replace("#STEPFORWARD#",""),a.controls_template=a.controls_template.replace("#FULLSCREEN#","")}a.controls&&t.closest("."+a.class_wrap).append(a.controls_template);var r=function(s){s&&s()},i=function(s){s.requestFullscreen?s.requestFullscreen():s.mozRequestFullScreen?s.mozRequestFullScreen():s.msRequestFullscreen?s.msRequestFullscreen():s.webkitRequestFullscreen&&s.webkitRequestFullscreen()},p=function(){var e=a.timeout;n=[],t.hasClass(a.class_done)&&_(),t.hasClass("forward")&&c--,t.hasClass(a.class_done)&&(t.removeClass(a.class_done),e+=a.reset_duration),t.removeClass(a.class_wait),r(a.callback_play),s.each(a.steps,function(s,l){if(c<s){var o=setTimeout(function(){c=s,t.addClass(l.addClass),t.removeClass(l.removeClass),"boolean"==typeof l.pause&&l.pause===!0&&(a.infinity=!1,u(!1)),a.steps.length-1===s&&d(l.duration)},e);"number"!=typeof l.duration&&(l.duration=500),e+=l.duration,n.push(o)}})},d=function(s){e=setTimeout(function(){t.addClass(a.class_done),t.hasClass(a.class_wait)||(a.infinity?p():r(a.callback_done))},s)},_=function(){s.each(a.steps,function(s,a){t.removeClass(a.addClass)}),c=-1},u=function(l){n.length>0&&(s.each(n,function(s,a){clearTimeout(n[s])}),l&&_(),t.addClass(a.class_wait),r(a.callback_wait),"undefined"!=typeof e&&clearTimeout(e))};a.autoplay?p():(t.addClass(a.class_wait),r(a.callback_wait)),t.click(function(){a.infinity=l,(t.hasClass(a.class_done)||t.hasClass(a.class_wait))&&p()}),t.next(a.controls_wrapper).find(a.step_backward_button).click(function(){(t.hasClass(a.class_done)||t.hasClass(a.class_wait))&&(t.hasClass(a.class_forward)&&c--,t.removeClass(a.class_forward),t.addClass(a.class_backward),c<0&&(c=a.steps.length),c===a.steps.length?s.each(a.steps,function(s,a){t.addClass(a.addClass),t.removeClass(a.removeClass)}):(t.removeClass(a.steps[c].addClass),t.addClass(a.steps[c].removeClass)),c--)}),t.next(a.controls_wrapper).find(a.play_button).click(function(){a.infinity=l,(t.hasClass(a.class_done)||t.hasClass(a.class_wait))&&p()}),t.next(a.controls_wrapper).find(a.pause_button).click(function(){a.infinity=!1,u(!1)}),t.next(a.controls_wrapper).find(a.reset_button).click(function(){a.infinity=!1,u(!0),_(),t.removeClass(a.class_done),t.addClass(a.class_wait),r(a.callback_wait)}),t.next(a.controls_wrapper).find(a.step_forward_button).click(function(){(t.hasClass(a.class_done)||t.hasClass(a.class_wait))&&(t.hasClass(a.class_backward)&&c++,t.addClass(a.class_forward),t.removeClass(a.class_backward),(c>a.steps.length||c===-1)&&(c=0),c===a.steps.length?_():(t.addClass(a.steps[c].addClass),t.removeClass(a.steps[c].removeClass)),c++)}),t.next(a.controls_wrapper).find(a.fullscreen_button).click(function(){i(t[0])})}}(jQuery);