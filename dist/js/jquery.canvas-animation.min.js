!function(u){u.fn.canvasAnimation=function(t){if("undefined"!==this.attr("id")){var a,o=this,i=[],l=-1,s=(t=u.extend(!0,{},{steps:[],timeout:0,resetDuration:500,infinite:!0,autoplay:!0,controls:!0,editor:{enable:!1,wrapper:".jca-editor-layer"},useIcons:!1,icons:{backward:'<i class="fas fa-step-backward"></i>',play:'<i class="fas fa-play"></i>',pause:'<i class="fas fa-pause"></i>',stop:'<i class="fas fa-stop"></i>',forward:'<i class="fas fa-step-forward"></i>',expand:'<i class="fas fa-expand"></i>',editor:'<i class="fas fa-edit"></i>'},controlsWrapper:".jca-controls",backwardButton:".jca-backward",playButton:".jca-play",pauseButton:".jca-pause",stopButton:".jca-stop",forwardButton:".jca-forward",expandButton:".jca-expand",editorButton:".jca-editor",classDone:"jca-done",classWait:"jca-wait",classForward:"jca-forward",classBackward:"jca-backward",classWrap:"jca-wrap",controlsTemplate:'<div class="jca-controls"><div class="jca-backward"></div><div class="jca-play"></div><div class="jca-pause"></div><div class="jca-stop"></div><div class="jca-forward"></div><div class="jca-expand"></div><div class="jca-editor"></div></div>',onPlay:null,onDone:null,onWait:null},t)).infinite,e=u(t.controlsTemplate);t.editor.enable=t.editor.enable&&"function"==typeof u.fn.canvasAnimationEditor,o.wrap('<div class="'+t.classWrap+'"></div>'),t.useIcons&&(u("html").addClass("jca-icons"),e.find(t.backwardButton).append(t.icons.backward),e.find(t.playButton).append(t.icons.play),e.find(t.pauseButton).append(t.icons.pause),e.find(t.stopButton).append(t.icons.stop),e.find(t.forwardButton).append(t.icons.forward),e.find(t.expandButton).append(t.icons.expand),e.find(t.editorButton).append(t.icons.editor)),t.controls&&(t.editor.enable||e.find(t.editorButton).remove(),o.closest("."+t.classWrap).append(e.clone()));var c=function(s){s&&s()},n=function(){var n=t.timeout;i=[],o.hasClass(t.classDone)&&d(),o.hasClass(t.classForward)&&l--,o.hasClass(t.classDone)&&(o.removeClass(t.classDone),n+=t.resetDuration),o.removeClass(t.classWait),c(t.onPlay),u.each(t.steps,function(s,a){if(l<s){var e=setTimeout(function(){l=s,o.addClass(a.addClass),o.removeClass(a.removeClass),"boolean"==typeof a.pause&&!0===a.pause&&(t.infinite=!1,p(!1)),t.steps.length-1===s&&r(a.duration)},n);"number"!=typeof a.duration&&(a.duration=500),n+=a.duration,i.push(e)}})},r=function(s){a=setTimeout(function(){o.addClass(t.classDone),o.hasClass(t.classWait)||(t.infinite?n():c(t.onDone))},s)},d=function(){u.each(t.steps,function(s,a){o.removeClass(a.addClass)}),l=-1},p=function(s){0<i.length&&(u.each(i,function(s,a){clearTimeout(i[s])}),s&&d(),o.addClass(t.classWait),c(t.onWait),void 0!==a&&clearTimeout(a))};t.autoplay?n():(o.addClass(t.classWait),c(t.onWait)),t.editor.enable||o.click(function(){t.infinite=s,(o.hasClass(t.classDone)||o.hasClass(t.classWait))&&n()}),o.next(t.controlsWrapper).find(t.backwardButton).click(function(){(o.hasClass(t.classDone)||o.hasClass(t.classWait))&&(o.hasClass(t.classForward)&&l--,o.removeClass(t.classForward),o.addClass(t.classBackward),l<0&&(l=t.steps.length),l===t.steps.length?u.each(t.steps,function(s,a){o.addClass(a.addClass),o.removeClass(a.removeClass)}):(o.removeClass(t.steps[l].addClass),o.addClass(t.steps[l].removeClass)),l--)}),o.next(t.controlsWrapper).find(t.playButton).click(function(){t.infinite=s,(o.hasClass(t.classDone)||o.hasClass(t.classWait))&&n()}),o.next(t.controlsWrapper).find(t.pauseButton).click(function(){t.infinite=!1,p(!1)}),o.next(t.controlsWrapper).find(t.stopButton).click(function(){t.infinite=!1,p(!0),d(),o.removeClass(t.classDone),o.addClass(t.classWait),c(t.onWait)}),o.next(t.controlsWrapper).find(t.forwardButton).click(function(){(o.hasClass(t.classDone)||o.hasClass(t.classWait))&&(o.hasClass(t.classBackward)&&l++,o.addClass(t.classForward),o.removeClass(t.classBackward),(l>t.steps.length||-1===l)&&(l=0),l===t.steps.length?d():(o.addClass(t.steps[l].addClass),o.removeClass(t.steps[l].removeClass)),l++)}),o.next(t.controlsWrapper).find(t.expandButton).click(function(){var s;(s=o[0]).requestFullscreen?s.requestFullscreen():s.mozRequestFullScreen?s.mozRequestFullScreen():s.msRequestFullscreen?s.msRequestFullscreen():s.webkitRequestFullscreen&&s.webkitRequestFullscreen()}),t.editor.enable&&(o.canvasAnimationEditor(t.editor),o.next(t.controlsWrapper).find(t.editorButton).click(function(){u(t.editor.wrapper).is(":visible")?u(t.editor.wrapper).hide():u(t.editor.wrapper).show()}))}}}(jQuery);