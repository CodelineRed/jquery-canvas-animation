!function(u){u.fn.canvasAnimation=function(n){var o,i,l,a,s,e,c,t,r,d,p;"undefined"!==this.attr("id")?(o=this,i=[],l=-1,s=(n=u.extend(!0,{},{steps:[],timeout:0,resetDuration:500,infinite:!0,autoplay:!0,controls:!0,canvasClick:!0,editor:{enable:!1,wrapper:".jca-editor-container"},useIcons:!1,icons:{backward:'<i class="fas fa-step-backward"></i>',play:'<i class="fas fa-play"></i>',pause:'<i class="fas fa-pause"></i>',stop:'<i class="fas fa-stop"></i>',forward:'<i class="fas fa-step-forward"></i>',expand:'<i class="fas fa-expand"></i>',editor:'<i class="fas fa-edit"></i>'},controlsWrapper:".jca-controls",backwardButton:".jca-backward",playButton:".jca-play",pauseButton:".jca-pause",stopButton:".jca-stop",forwardButton:".jca-forward",expandButton:".jca-expand",editorButton:".jca-editor",gotoButton:".jca-goto",classDone:"jca-done",classWait:"jca-wait",classForward:"jca-forward",classBackward:"jca-backward",classWrap:"jca-wrap",controlsTemplate:'<div class="jca-controls"><div class="jca-backward"></div><div class="jca-play"></div><div class="jca-pause"></div><div class="jca-stop"></div><div class="jca-forward"></div><div class="jca-expand"></div><div class="jca-editor"></div></div>',onPlay:null,onDone:null,onWait:null},n)).infinite,e=u(n.controlsTemplate),n.editor.enable=n.editor.enable&&"function"==typeof u.fn.canvasAnimationEditor,o.wrap('<div class="'+n.classWrap+'"></div>'),n.useIcons&&(u("html").addClass("jca-icons"),e.find(n.backwardButton).append(n.icons.backward),e.find(n.playButton).append(n.icons.play),e.find(n.pauseButton).append(n.icons.pause),e.find(n.stopButton).append(n.icons.stop),e.find(n.forwardButton).append(n.icons.forward),e.find(n.expandButton).append(n.icons.expand),e.find(n.editorButton).append(n.icons.editor)),n.controls&&(n.editor.enable||e.find(n.editorButton).remove(),o.closest("."+n.classWrap).append(e.clone())),c=function(s){s&&s()},t=function(){var t=n.timeout;i=[],o.hasClass(n.classDone)&&d(),o.hasClass(n.classForward)&&l--,o.hasClass(n.classDone)&&(o.removeClass(n.classDone),t+=n.resetDuration),o.removeClass(n.classWait),c(n.onPlay),u.each(n.steps,function(s,a){var e;l<s&&(e=setTimeout(function(){l=s,o.addClass(a.addClass),o.removeClass(a.removeClass),"boolean"==typeof a.pause&&!0===a.pause&&(n.infinite=!1,p(!1)),n.steps.length-1===s&&r(a.duration)},t),"number"!=typeof a.duration&&(a.duration=500),t+=a.duration,i.push(e))})},r=function(s){a=setTimeout(function(){o.addClass(n.classDone),o.hasClass(n.classWait)||(n.infinite?t():c(n.onDone))},s)},d=function(){u.each(n.steps,function(s,a){o.removeClass(a.addClass)}),l=-1},p=function(s){0<i.length&&(u.each(i,function(s,a){clearTimeout(i[s])}),s&&d(),o.addClass(n.classWait),c(n.onWait),void 0!==a&&clearTimeout(a))},n.autoplay?t():(o.addClass(n.classWait),c(n.onWait)),!n.editor.enable&&n.canvasClick&&o.click(function(){n.infinite=s,(o.hasClass(n.classDone)||o.hasClass(n.classWait))&&t()}),o.next(n.controlsWrapper).find(n.backwardButton).click(function(){(o.hasClass(n.classDone)||o.hasClass(n.classWait))&&(o.hasClass(n.classForward)&&l--,o.removeClass(n.classForward),o.addClass(n.classBackward),(l=l<0?n.steps.length:l)===n.steps.length?u.each(n.steps,function(s,a){o.addClass(a.addClass),o.removeClass(a.removeClass)}):(o.removeClass(n.steps[l].addClass),o.addClass(n.steps[l].removeClass)),l--)}),o.next(n.controlsWrapper).find(n.playButton).click(function(){n.infinite=s,(o.hasClass(n.classDone)||o.hasClass(n.classWait))&&t()}),o.next(n.controlsWrapper).find(n.pauseButton).click(function(){n.infinite=!1,p(!1)}),o.next(n.controlsWrapper).find(n.stopButton).click(function(){n.infinite=!1,p(!0),d(),o.removeClass(n.classDone),o.addClass(n.classWait),c(n.onWait)}),o.next(n.controlsWrapper).find(n.forwardButton).click(function(){(o.hasClass(n.classDone)||o.hasClass(n.classWait))&&(o.hasClass(n.classBackward)&&l++,o.addClass(n.classForward),o.removeClass(n.classBackward),(l=l>n.steps.length||-1===l?0:l)===n.steps.length?d():(o.addClass(n.steps[l].addClass),o.removeClass(n.steps[l].removeClass)),l++)}),o.next(n.controlsWrapper).find(n.expandButton).click(function(){var s;(s=o[0]).requestFullscreen?s.requestFullscreen():s.mozRequestFullScreen?s.mozRequestFullScreen():s.msRequestFullscreen?s.msRequestFullscreen():s.webkitRequestFullscreen&&s.webkitRequestFullscreen()}),n.editor.enable&&(o.canvasAnimationEditor(n.editor),o.next(n.controlsWrapper).find(n.editorButton).click(function(){u(n.editor.wrapper).is(":visible")?u(n.editor.wrapper).hide():u(n.editor.wrapper).show()})),o.find(n.gotoButton).click(function(){if(o.hasClass(n.classDone)||o.hasClass(n.classWait)){let e=this;u.each(n.steps,function(s,a){if("string"==typeof a.name&&a.name===u(e).data("step"))return o.addClass(a.addClass),o.removeClass(a.removeClass),!1})}})):alert('Canvas must have attribute "id".')}}(jQuery);