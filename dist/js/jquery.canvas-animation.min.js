!function(u){u.fn.canvasAnimation=function(t){var a,n=this,s=(t=u.extend({steps:[],timeout:0,resetDuration:500,infinity:!0,autoplay:!0,controls:!0,fontawesomeVersion:null,controlsWrapper:".controls",backwardButton:".backward",playButton:".play",pauseButton:".pause",resetButton:".reset",forwardButton:".forward",fullscreenButton:".fullscreen",classDone:"done",classWait:"wait",classForward:"forward",classBackward:"backward",classWrap:"canvas-animation",controlsTemplate:'<div class="controls"><div class="backward #BACKWARD#"></div><div class="play #PLAY#"></div><div class="pause #PAUSE#"></div><div class="reset #RESET#"></div><div class="forward #FORWARD#"></div><div class="fullscreen #FULLSCREEN#"></div></div>',onPlay:null,onDone:null,onWait:null},t)).infinity,o=[],c=-1;switch(n.wrap('<div class="'+t.classWrap+'"></div>'),parseInt(t.fontawesomeVersion)){case 4:case 5:var e="fa";5===parseInt(t.fontawesomeVersion)&&(e="fas"),t.controlsTemplate=t.controlsTemplate.replace("#BACKWARD#",e+" fa-step-backward"),t.controlsTemplate=t.controlsTemplate.replace("#PLAY#",e+" fa-play"),t.controlsTemplate=t.controlsTemplate.replace("#PAUSE#",e+" fa-pause"),t.controlsTemplate=t.controlsTemplate.replace("#RESET#",e+" fa-stop"),t.controlsTemplate=t.controlsTemplate.replace("#FORWARD#",e+" fa-step-forward"),t.controlsTemplate=t.controlsTemplate.replace("#FULLSCREEN#",e+" fa-expand");break;default:t.controlsTemplate=t.controlsTemplate.replace("#BACKWARD#",""),t.controlsTemplate=t.controlsTemplate.replace("#PLAY#",""),t.controlsTemplate=t.controlsTemplate.replace("#PAUSE#",""),t.controlsTemplate=t.controlsTemplate.replace("#RESET#",""),t.controlsTemplate=t.controlsTemplate.replace("#FORWARD#",""),t.controlsTemplate=t.controlsTemplate.replace("#FULLSCREEN#","")}t.controls&&n.closest("."+t.classWrap).append(t.controlsTemplate);var r=function(s){s&&s()},l=function(){var l=t.timeout;o=[],n.hasClass(t.classDone)&&p(),n.hasClass("forward")&&c--,n.hasClass(t.classDone)&&(n.removeClass(t.classDone),l+=t.resetDuration),n.removeClass(t.classWait),r(t.onPlay),u.each(t.steps,function(s,a){if(c<s){var e=setTimeout(function(){c=s,n.addClass(a.addClass),n.removeClass(a.removeClass),"boolean"==typeof a.pause&&!0===a.pause&&(t.infinity=!1,d(!1)),t.steps.length-1===s&&i(a.duration)},l);"number"!=typeof a.duration&&(a.duration=500),l+=a.duration,o.push(e)}})},i=function(s){a=setTimeout(function(){n.addClass(t.classDone),n.hasClass(t.classWait)||(t.infinity?l():r(t.onDone))},s)},p=function(){u.each(t.steps,function(s,a){n.removeClass(a.addClass)}),c=-1},d=function(s){0<o.length&&(u.each(o,function(s,a){clearTimeout(o[s])}),s&&p(),n.addClass(t.classWait),r(t.onWait),void 0!==a&&clearTimeout(a))};t.autoplay?l():(n.addClass(t.classWait),r(t.onWait)),n.click(function(){t.infinity=s,(n.hasClass(t.classDone)||n.hasClass(t.classWait))&&l()}),n.next(t.controlsWrapper).find(t.backwardButton).click(function(){(n.hasClass(t.classDone)||n.hasClass(t.classWait))&&(n.hasClass(t.classForward)&&c--,n.removeClass(t.classForward),n.addClass(t.classBackward),c<0&&(c=t.steps.length),c===t.steps.length?u.each(t.steps,function(s,a){n.addClass(a.addClass),n.removeClass(a.removeClass)}):(n.removeClass(t.steps[c].addClass),n.addClass(t.steps[c].removeClass)),c--)}),n.next(t.controlsWrapper).find(t.playButton).click(function(){t.infinity=s,(n.hasClass(t.classDone)||n.hasClass(t.classWait))&&l()}),n.next(t.controlsWrapper).find(t.pauseButton).click(function(){t.infinity=!1,d(!1)}),n.next(t.controlsWrapper).find(t.resetButton).click(function(){t.infinity=!1,d(!0),p(),n.removeClass(t.classDone),n.addClass(t.classWait),r(t.onWait)}),n.next(t.controlsWrapper).find(t.forwardButton).click(function(){(n.hasClass(t.classDone)||n.hasClass(t.classWait))&&(n.hasClass(t.classBackward)&&c++,n.addClass(t.classForward),n.removeClass(t.classBackward),(c>t.steps.length||-1===c)&&(c=0),c===t.steps.length?p():(n.addClass(t.steps[c].addClass),n.removeClass(t.steps[c].removeClass)),c++)}),n.next(t.controlsWrapper).find(t.fullscreenButton).click(function(){var s;(s=n[0]).requestFullscreen?s.requestFullscreen():s.mozRequestFullScreen?s.mozRequestFullScreen():s.msRequestFullscreen?s.msRequestFullscreen():s.webkitRequestFullscreen&&s.webkitRequestFullscreen()})}}(jQuery);