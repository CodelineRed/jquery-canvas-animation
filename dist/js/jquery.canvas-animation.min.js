!function(s){s.fn.canvasAnimation=function(a){var e,l=this,a=s.extend({steps:[],timeout:0,resetDuration:500,infinity:!0,autoplay:!0,controls:!0,fontawesomeVersion:null,controlsWrapper:".controls",backwardButton:".backward",playButton:".play",pauseButton:".pause",resetButton:".reset",forwardButton:".forward",fullscreenButton:".fullscreen",classDone:"done",classWait:"wait",classForward:"forward",classBackward:"backward",classWrap:"canvas-animation",controlsTemplate:'<div class="controls"><div class="backward #BACKWARD#"></div><div class="play #PLAY#"></div><div class="pause #PAUSE#"></div><div class="reset #RESET#"></div><div class="forward #FORWARD#"></div><div class="fullscreen #FULLSCREEN#"></div></div>',onPlay:null,onDone:null,onWait:null},a),t=a.infinity,n=[],o=-1;switch(l.wrap('<div class="'+a.classWrap+'"></div>'),parseInt(a.fontawesomeVersion)){case 4:case 5:var c="fa";5===parseInt(a.fontawesomeVersion),a.controlsTemplate=a.controlsTemplate.replace("#BACKWARD#",c+" fa-step-backward"),a.controlsTemplate=a.controlsTemplate.replace("#PLAY#",c+" fa-play"),a.controlsTemplate=a.controlsTemplate.replace("#PAUSE#",c+" fa-pause"),a.controlsTemplate=a.controlsTemplate.replace("#RESET#",c+" fa-stop"),a.controlsTemplate=a.controlsTemplate.replace("#FORWARD#",c+" fa-step-forward"),a.controlsTemplate=a.controlsTemplate.replace("#FULLSCREEN#",c+" fa-expand");break;default:a.controlsTemplate=a.controlsTemplate.replace("#BACKWARD#",""),a.controlsTemplate=a.controlsTemplate.replace("#PLAY#",""),a.controlsTemplate=a.controlsTemplate.replace("#PAUSE#",""),a.controlsTemplate=a.controlsTemplate.replace("#RESET#",""),a.controlsTemplate=a.controlsTemplate.replace("#FORWARD#",""),a.controlsTemplate=a.controlsTemplate.replace("#FULLSCREEN#","")}a.controls&&l.closest("."+a.classWrap).append(a.controlsTemplate);var r=function(s){s&&s()},i=function(s){s.requestFullscreen?s.requestFullscreen():s.mozRequestFullScreen?s.mozRequestFullScreen():s.msRequestFullscreen?s.msRequestFullscreen():s.webkitRequestFullscreen&&s.webkitRequestFullscreen()},p=function(){var e=a.timeout;n=[],l.hasClass(a.classDone)&&u(),l.hasClass("forward")&&o--,l.hasClass(a.classDone)&&(l.removeClass(a.classDone),e+=a.resetDuration),l.removeClass(a.classWait),r(a.onPlay),s.each(a.steps,function(s,t){if(o<s){var c=setTimeout(function(){o=s,l.addClass(t.addClass),l.removeClass(t.removeClass),"boolean"==typeof t.pause&&t.pause===!0&&(a.infinity=!1,f(!1)),a.steps.length-1===s&&d(t.duration)},e);"number"!=typeof t.duration&&(t.duration=500),e+=t.duration,n.push(c)}})},d=function(s){e=setTimeout(function(){l.addClass(a.classDone),l.hasClass(a.classWait)||(a.infinity?p():r(a.onDone))},s)},u=function(){s.each(a.steps,function(s,a){l.removeClass(a.addClass)}),o=-1},f=function(t){n.length>0&&(s.each(n,function(s,a){clearTimeout(n[s])}),t&&u(),l.addClass(a.classWait),r(a.onWait),"undefined"!=typeof e&&clearTimeout(e))};a.autoplay?p():(l.addClass(a.classWait),r(a.onWait)),l.click(function(){a.infinity=t,(l.hasClass(a.classDone)||l.hasClass(a.classWait))&&p()}),l.next(a.controlsWrapper).find(a.backwardButton).click(function(){(l.hasClass(a.classDone)||l.hasClass(a.classWait))&&(l.hasClass(a.classForward)&&o--,l.removeClass(a.classForward),l.addClass(a.classBackward),o<0&&(o=a.steps.length),o===a.steps.length?s.each(a.steps,function(s,a){l.addClass(a.addClass),l.removeClass(a.removeClass)}):(l.removeClass(a.steps[o].addClass),l.addClass(a.steps[o].removeClass)),o--)}),l.next(a.controlsWrapper).find(a.playButton).click(function(){a.infinity=t,(l.hasClass(a.classDone)||l.hasClass(a.classWait))&&p()}),l.next(a.controlsWrapper).find(a.pauseButton).click(function(){a.infinity=!1,f(!1)}),l.next(a.controlsWrapper).find(a.resetButton).click(function(){a.infinity=!1,f(!0),u(),l.removeClass(a.classDone),l.addClass(a.classWait),r(a.onWait)}),l.next(a.controlsWrapper).find(a.forwardButton).click(function(){(l.hasClass(a.classDone)||l.hasClass(a.classWait))&&(l.hasClass(a.classBackward)&&o++,l.addClass(a.classForward),l.removeClass(a.classBackward),(o>a.steps.length||o===-1)&&(o=0),o===a.steps.length?u():(l.addClass(a.steps[o].addClass),l.removeClass(a.steps[o].removeClass)),o++)}),l.next(a.controlsWrapper).find(a.fullscreenButton).click(function(){i(l[0])})}}(jQuery);